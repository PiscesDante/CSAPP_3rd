# Lecture 11. The Memory Hierarchy

## 今日话题

*   存储的技术和趋势；
*   程序的局部性（Locality of Reference）；
*   分级内存的缓存策略；

## 随机访问存储器（ RAM ）

### 核心特性

*   RAM 经常被集成为一个单独的元器件（芯片）；
*   最基本的存储单元通常是一个「单元」（每个细胞代表 1 个位）；
*   很多个 RAM 芯片组成了内存；

### RAM 有两种形态

*   SRAM （ 静态 RAM ）；
*   DRAM（ 动态 RAM ）；

## SRAM 和 DRAM 的对比

*   SRAM 需要更多的晶体管来存储数据，因此造价也非常高，并且比 DRAM 的速度要快的多；
*   DRAM 需要插着电用。SRAM 不需要错误检测和纠正。
*   SRAM 用于内存容量小但是需要速度非常快的芯片中，我们称之为高速缓存；DRAM 用于内存等等用途。

## 非易失的存储

*   DRAM 和 SRAM 都是易失性存储：当设备断电之后，存储的东西就丢失了；
*   非易失性存储即使在断电的情况下还是能保存其中的数据；
    *   ROM ：再生产的过程中已经编写好了程序，程序是被硬编码在硬件中的；
    *   PROM ：只能被自定义编写一次，这也就是 Programmable 的来源；
    *   EPROM ：可以被紫外线或者 X 光擦掉其中的数据然后重新注入；
    *   EEPROM ：可以使用电子来擦除其中的数据然后重新注入；
    *   闪存（ Flash Memery ）：EEPROM 的进化版，可以针对特定区块对数据进行擦除和写入，但是这个擦除次数是有限制的，一般来说对于一个存储单元擦除的限制是 100000 次。
*   非易失性存储的用途
    *   硬件层面的程序一般存储在 ROM 中，比如说计算机的 BIOS ，网卡的 I/O ，子系统等等，这些硬件的程序只需要撰写一次即可。
    *   SSD ，也就是常说的固态硬盘；

## 传统的总线连接结构：处理器和 RAM

*   总线一个集合，这个集合中包含一系列并行的电线，用来传递地址，数据以及控制信号。
*   总线一般来说被好几个设备共享。

主存，也就是我们所说的内存，是通过一些电子线路连接到 CPU 的。这些电子线路就被统称为总线。任何数据和信号都是通过总线在各个元器件之间传输。

## 内存读取传输 #1 #2 #3

内存中的数据是如何通过总线传输到各个元器件的。

## 磁盘驱动器中有什么？



## 磁盘的几何构成

*   磁盘由盘片构成，每个盘片中有 2 个盘面。
*   每个盘面由叫做「磁道」的同心圆组成；
*   每个磁道又被「间隔」划分为「扇区」；

## 磁盘容量

*   容量：磁盘所能存储的比特数；
*   容量受以下技术因素影响：
    *   记录密度：1 英寸的磁道上所能承载的比特数量；
    *   磁道密度：1 英寸半径上所能容纳的磁道数量；
    *   盘面密度：磁道密度 ×记录密度；

## 记录区

*   现代磁盘将磁道划分为彼此独立的子集，这个子集就被称为「记录区」
    *   记录区中的每个磁道都拥有相同数量的扇区；每个磁道所包含的扇区数量是一个常数；这个记录区中每个磁道所能包含的扇区数是由最里面的那个磁道所决定的。
    *   每个记录区有着不同的扇区数和磁道数，外层记录区的扇区数和磁道数要比内层的多；
    *   故，我们使用平均值来计算磁盘的容量；

## 磁盘操作（单盘面视角）

磁盘是依靠旋转来进行操作的，因此机械磁盘都有一个很关键的参数叫做「转速」。

## 磁盘访问 - 读取

当处理器需要读取磁盘中的某个数据时，只需要知道扇区和磁道即可访问磁盘中的数据。磁盘中的磁头首先要将磁头放置到存储有目标数据的磁道，然后等待目标数据的扇区转过来即可。

三个因素：移动磁头的时间称为「寻道时间」，等待磁盘旋转的时间称为「硬盘转速」，然后就是数据传输的速度了。

## 磁盘访问时间

*   访问目标扇区的平均时间大约为：
    $$
    T_{access}=Seek+Rotation+Tranformation
    $$

*   寻道时间：一般来说就是 3 - 9 ms 这是一种基本的机械限制，降低基本上是不可能的；

*   平均旋转时间：这个基本上也受到机械原理限制；

*   传输时间：基本上可以忽略不计；

## 逻辑磁盘分区

现代磁盘控制器将磁盘描述为逻辑块，并且提供给处理器进行使用；每个块都是扇区的整数倍；块从 0 开始编号并且递增；

**<u>磁盘控制器保持映射物理扇区和逻辑分区之间的关系</u>** 。这本质上也是一种很高级的抽象；这种抽象可以让控制器保留一些扇区作为备份；以便某些区块坏了之后可以启用这些备份的扇区。这也就是为什么我们看到的磁盘的格式容量要比实际容量要小。因为其中一些扇区是为了容灾而准备的。

PCIE 总线是点对点的。提供 PCI 相同的功能但是更快更高效。

固态硬盘因为分页机制，写操作将变得非常的昂贵。

